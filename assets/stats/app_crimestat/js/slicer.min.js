var Slicer=function(){return function(l,m){var a=this;a.selected={};a.dimid=l;a.dimension=m;a.hasTopElement=!0;a.topElement;a.maxLevel=0;"geo"==a.dimension.type&&(a.dimension.values=Hierarchy.common.geo);a.getUrlVars=function(){for(var a=[],c,d=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),e=0;e<d.length;e++)c=d[e].split("="),a.push(c[0]),a[c[0]]=c[1];return a};var n=a.getUrlVars();a.lang=(n.lang||"NL").toUpperCase();a.bind=function(b,c){a.scope=d3.select(b).append("div").classed("slicer",
!0);a.addLevel(0);EventBus.register(a,"drilldown",a.onDrilldown);c&&c()};a.addLevel=function(b,c){for(var d=b;d<=a.maxLevel;d++)a.scope.selectAll(".slicer-level"+d).remove();var e=a.scope.append("div").attr("class","slicer-level slicer-level"+b),g=e.append("select").attr("class","level"+b).on("change",function(){a.update(b)});c||(a.hasTopElement?(c=d3.entries(a.dimension.values[0])[0],a.topElement=c.key):(c={key:""},a.topElement=""));c.value={NL:"Alle",FR:"Tout"};g.append("option").attr("value",c.key).text(c.value[a.lang]);
a.selected[b]=c.key;a.maxLevel=b;var k=a.getValues(b+1),f=[],h=-1;k.forEach(function(b){var c=d3.keys(b)[0];h++;f[h]=[];f[h][0]=b[c][a.lang];f[h][1]="tree"==Hierarchy.type(a.dimension.values)?c:b;f[h][2]="tree"==Hierarchy.type(a.dimension.values)?b[c][a.lang]:b});f.sort();for(d=0;d<=h;d++)g.append("option").attr("value",f[d][1]).text(f[d][2]);0==k.length&&e.style("display","none")};this.update=function(b,c){var d=a.scope.select(".level"+b)[0][0].value;if(0==a.scope.select(".level"+b)[0][0].selectedIndex){for(var e=
b+1;e<=a.maxLevel;e++)a.scope.selectAll(".slicer-level"+e).remove();a.maxLevel=b}else"tree"==Hierarchy.type(a.dimension.values)&&a.addLevel(b+1,{key:d,value:Hierarchy.subtree(a.dimension.values,d)[d]});"a"==a.dimid&&(l_category2_flag=0==a.scope.select(".level"+b)[0][0].selectedIndex?1:0);"s"==a.dimid&&(l_category1_flag=0==a.scope.select(".level"+b)[0][0].selectedIndex?1:0);l_category1_flag?(l_category2_flag?(document.getElementById("category1").style.display="none",document.getElementById("category2").style.display=
"none",document.getElementById("choropleth").style.display="none",document.getElementById("dashboard_img_1").style.display=""):(document.getElementById("category1").style.display="",document.getElementById("category2").style.display="none",document.getElementById("choropleth").style.display="none",document.getElementById("dashboard_img_1").style.display="none"),document.getElementById("dashboard_img_2").style.display="",document.getElementById("dashboard_img_3").style.display=""):l_category2_flag?
(document.getElementById("category1").style.display="none",document.getElementById("category2").style.display="",document.getElementById("choropleth").style.display="none",document.getElementById("dashboard_img_1").style.display="",document.getElementById("dashboard_img_2").style.display="none",document.getElementById("dashboard_img_3").style.display=""):(document.getElementById("category1").style.display="",document.getElementById("category2").style.display="",document.getElementById("choropleth").style.display=
"",document.getElementById("dashboard_img_1").style.display="none",document.getElementById("dashboard_img_2").style.display="none",document.getElementById("dashboard_img_3").style.display="none");c||EventBus.emit(a,"drilldown",{dimension:a.dimid,value:d})};this.onDrilldown=function(b){if(b.dimension==a.dimid){b.value=""==b.value?a.topElement:b.value;var c=Hierarchy.path(a.dimension.values,b.value);a.scope.selectAll(".slicer-level").remove();if(b.value==a.topElement)a.addLevel(0,{key:a.dimid,value:b.value});
else for(b=c.length-1;0<=b;b--){var d=d3.keys(c[b])[0],e=c.length-b-1;1<=e&&(a.scope.select(".level"+(e-1))[0][0].value=d);a.addLevel(e,{key:d,value:{NL:"Alle",FR:"Tout"}});a.update(e,!0)}}};this.getValues=function(b,c){for(var d=a.dimension.values,e=0;e<=b-1;e++){var g=0==e?a.topElement:a.scope.select(".level"+(e-1))[0][0].value;g&&(d=d.filter(function(a){return d3.keys(a)[0]==g})[0][g].values)}return d||[]};a.hasTopElement=1==a.dimension.values.length}}();