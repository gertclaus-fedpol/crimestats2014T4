var l_legend_width=213,Timeline=function(){return function(){var a=this;this.noPrebuildSVG=!0;this.dataLabels={};this.quantiles={};this.datapoints;this.brush;this.prev_rulerkey;this.keyruler;this.tooltip;this.name="timeline";this.detail={};this.master={};this.detail.margin={top:50,right:50,bottom:30,left:50};this.master.margin={top:10,right:50,bottom:30,left:50};this.graphs=["detail","master"];this.legendWidth=l_legend_width;this.bind=function(a){d3.select(a).append("div").classed("body timeline",
!0).html('  <div class="graph"></div>  <div class="tooltip hidden"></div>  <div class="legend">    <div class="series">      <span class="sidebar-title legend-title">Legende</span>    </div>  </div>')};this.updateData=function(c){var b=0;c.forEach(function(e){var c=a.viz.definition.x.dimension,g=f.informat(e[c],a.viz.data.dimensions[c].type,a.viz.data.dimensions[c].informat);a.keys.forEach(function(c,d){void 0===a.index[g.getTime()]?(a.index[g.getTime()]=b,a.data[b]={x:g,y:[]},a.data[b].y[d]=e[c],
b++):a.data[a.index[g.getTime()]].y[d]=e[c]})})};this.determineMaxLength=function(){this.maxLength=0;a.viz.original.facts.forEach(function(c){a.keys.forEach(function(b,e){var d=f.format(c[b],a.viz.data.measures[b],a.viz.definition.y[e].format[a.viz.lang],a.viz.lang);a.maxLength=d.length>a.maxLength?d.length:a.maxLength})})};this.initialize=function(){this.keys=this.viz.definition.y.map(function(a){return a.measure});this.data=[];this.index={};this.determineMaxLength();this.updateData(this.viz.data.facts);
if(void 0!==this.viz.definition.options&&void 0!==this.viz.definition.options.visible){var c=Math.max(0,this.data.length-this.viz.definition.options.visible);this.data=this.data.slice(c,this.data.length)}var b=this.viz.definition.subject[this.viz.lang].title;a.viz.scope.select(".legend-title").html("FR"==a.viz.lang?"L\u00e9gende":"EN"==a.viz.lang?"Legend":"Legende");1==this.keys.length&&(this.legendWidth=0,a.viz.scope.select(".legend").hide());this.detail.margin.left=this.master.margin.left=15+6*
this.maxLength;this.viz.changeDimensions((this.viz.getUrlVar("width")||a.viz.definition.options.viz_width||800)*this.viz.size,(this.viz.getUrlVar("height")||a.viz.definition.options.viz_height||350)*this.viz.size,!1);this.master.width=this.detail.width=this.viz.width-this.legendWidth;this.detail.height=this.viz.height-75;this.master.height=75;"render"==this.viz.mode&&(this.detail.height+=this.master.height);this.legend.initialize();this.axes.initialize();this.graphs.forEach(function(b){a[b].line=
a.keys.map(function(c,e){return d3.svg.line().x(function(c){return a.axes[b].scale.x(c.x)}).y(function(c){return a.axes[b].scale.y(c.y[e])}).interpolate(a.viz.definition.options&&a.viz.definition.options.interpolation?a.viz.definition.options.interpolation:"monotone")})});this.detail.area=this.keys.map(function(b,c){return d3.svg.area().x(function(b){return a.axes.detail.scale.x(b.x)}).y0(a.axes.detail.scale.y.range()[0]).y1(function(b){return a.axes.detail.scale.y(b.y[c])}).interpolate(a.viz.definition.options&&
a.viz.definition.options.interpolation?a.viz.definition.options.interpolation:"monotone")});var e=a.viz.scope.select(".graph").style("width",this.detail.width+"px").style("height",this.detail.height+"px"),c=e.data([this.data]).append("svg").attr("class","detail").attr("width",this.detail.width).attr("height",this.detail.height);c.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",this.detail.width-this.detail.margin.left-this.detail.margin.right).attr("height",this.detail.height-
this.detail.margin.top-this.detail.margin.bottom);c.append("svg:text").attr("class","title").attr("transform","translate("+this.detail.width/2+",20)").attr("text-anchor","middle").text(b);c=c.append("g").attr("transform","translate("+this.detail.margin.left+","+this.detail.margin.top+")");c.append("g").attr("class","x axis").attr("transform","translate(0,"+this.axes.detail.scale.y.range()[0]+")").call(this.axes.detail.axis.x);c.append("g").attr("class","y axis").attr("transform","translate(0,"+this.axes.detail.scale.x.range()[0]+
")").call(this.axes.detail.axis.y);b=c.append("g").classed("clip-path chartLevel",!0).attr("clip-path","url(#clip)");b.append("g").attr("class","areas");b.append("g").attr("class","lines");var d=b.append("g").attr("class","points");if("render"!==this.viz.mode){var g=e.append("svg").attr("class","master").attr("width",this.master.width).attr("height",this.master.height).append("g").classed("chartLevel",!0).attr("transform","translate("+this.master.margin.left+","+this.master.margin.top+")");g.append("g").attr("class",
"lines");g.append("g").attr("class","x axis").attr("transform","translate(0,"+this.axes.master.scale.y.range()[0]+")").call(this.axes.master.axis.x)}this.keys.forEach(function(b,c){d.append("g").attr("class","datapointseries").selectAll("circle").data(a.data).enter().append("circle").classed("datapoint",!0).classed("datapoint"+b,!0).attr("r",2.5);"undefined"!==typeof a.viz.definition.y[c].color&&a.viz.scope.selectAll(".detail .datapoint"+b).style("fill",a.viz.definition.y[a.keys.indexOf(b)].color)});
this.graphs.forEach(function(b){a.keys.forEach(function(c,e){var d=a.viz.scope.select("."+b+" .chartLevel .lines").append("path").attr("class","line").attr("id","line"+c),g=null;"master"==b?d.attr("d",a.master.line[e]):g=a.viz.scope.select("."+b+" .chartLevel .areas").append("path").attr("class","area").attr("id","area"+c);"undefined"!==typeof a.viz.definition.y[e].color?(d.style("stroke",a.viz.definition.y[e].color),null!=g&&g.style("fill",a.viz.definition.options&&a.viz.definition.options.area?
a.viz.definition.y[e].color:"none")):null!=g&&g.style("fill",a.viz.definition.options&&a.viz.definition.options.area?"":"none")})});this.brush=d3.svg.brush().x(this.axes.master.scale.x).on("brush",function(){a.redraw();EventBus.emit(a,"brush",a.brush.extent())});this.resetBrush();this.redraw();"render"!==a.viz.mode&&(g=g.append("g").attr("class","brush").call(this.brush),g.selectAll(".resize").append("path").attr("transform","translate(0,"+this.master.height-this.master.margin.top-this.master.margin.bottom+
")"),g.selectAll("rect").attr("height",this.master.height-this.master.margin.top-this.master.margin.bottom));this.keyruler=c.append("line").attr("class","ruler");this.tooltip=a.viz.scope.select(".tooltip");c.append("rect").attr("class","mousedetector").attr("width",this.detail.width-this.master.margin.right-this.master.margin.left).attr("height",this.detail.height-this.master.margin.bottom-this.master.margin.top).on("mousemove",this.showTooltip).on("mouseout",this.hideTooltip);EventBus.register(this,
"brush",this.onBrush)};this.onBrush=function(c){a.brush.extent(c);a.brush(a.viz.scope.select(".brush"));a.redraw()};this.redraw=function(c){c=!0===c;a.axes.detail.scale.x.domain(a.brush.empty()?a.axes.master.scale.x.domain():a.brush.extent());a.axes.detail.scale.y.domain([d3.min(a.data,function(b){return a.axes.detail.scale.x(b.x)>=a.axes.detail.scale.x.range()[0]&&a.axes.detail.scale.x(b.x)<=a.axes.detail.scale.x.range()[1]?Math.min.apply(Math,b.y.filter(a.legend.isActive)):Infinity}),d3.max(a.data,
function(b){return a.axes.detail.scale.x(b.x)>=a.axes.detail.scale.x.range()[0]&&a.axes.detail.scale.x(b.x)<=a.axes.detail.scale.x.range()[1]?Math.max.apply(Math,b.y.filter(a.legend.isActive)):-Infinity})]).nice();a.axes.master.scale.y.domain([d3.min(a.data,function(b){return a.axes.master.scale.x(b.x)>=a.axes.master.scale.x.range()[0]&&a.axes.master.scale.x(b.x)<=a.axes.master.scale.x.range()[1]?Math.min.apply(Math,b.y):Infinity}),d3.max(a.data,function(b){return a.axes.master.scale.x(b.x)>=a.axes.master.scale.x.range()[0]&&
a.axes.master.scale.x(b.x)<=a.axes.master.scale.x.range()[1]?Math.max.apply(Math,b.y):-Infinity})]).nice();isNaN(a.axes.detail.scale.y.domain()[0])||isNaN(a.axes.detail.scale.y.domain()[1])||(a.viz.scope.select(".detail .x.axis").call(a.axes.detail.axis.x),a.viz.scope.select(".detail .y.axis").call(a.axes.detail.axis.y),"render"!==a.mode&&a.viz.scope.select(".master .x.axis").call(a.axes.master.axis.x),a.keys.forEach(function(b,e){if("render"!==a.mode){var d=a.viz.scope.select(".master #line"+b);
c&&(d=d.transition());d.attr("d",a.master.line[e])}d=a.viz.scope.select(".detail #line"+b);c&&(d=d.transition());d.attr("d",a.detail.line[e]).style("opacity",a.legend.isActive(null,e)?1:1E-5);d=a.viz.scope.select(".detail #area"+b);c&&(d=d.transition());d.attr("d",a.detail.area[e]).style("opacity",a.legend.isActive(null,e)?0.2:1E-5);var g=a.axes.detail.scale.x.domain(),d=a.viz.scope.selectAll(".detail .datapoint"+b);c&&(d=d.transition());d.attr("cx",function(b){return a.axes.detail.scale.x(b.x)}).attr("cy",
function(b){return a.axes.detail.scale.y(b.y[e])}).attr("r",Math.max(0.5,3*(1-(g[1]-g[0])/(a.data[a.data.length-1].x-a.data[0].x)))).style("opacity",a.legend.isActive(null,e)?1:1E-5)}))};this.showTooltip=function(){var c=d3.event.pageX-a.detail.margin.left-$(a.viz.scopeStr+" .body").offset().left,b=1E11,e=null;a.data.forEach(function(d){var g=Math.abs(a.axes.detail.scale.x(d.x)-c);g<b&&(b=g,e=d)});if(a.prev_rulerkey!=e.x){var d=a.axes.detail.scale.y(Math.max.apply(null,e.y.filter(a.legend.isActive)));
a.keyruler.attr("x1",a.axes.detail.scale.x(e.x)).attr("x2",a.axes.detail.scale.x(e.x)).attr("y1",d).attr("y2",a.detail.height-a.detail.margin.top-a.detail.margin.bottom).show();d=a.viz.definition.x;d=f.format(e.x,a.viz.data.dimensions[d.dimension],d.format[a.viz.lang],a.viz.lang);a.tooltip.text("");a.tooltip.append("span").attr("class","tooltipkey").text(d);a.tooltip.append("table");var g=a.keys.filter(a.legend.isActive);for(i=0;i<e.y.length;i++)if(0<=g.indexOf(a.keys[i])){var h=a.tooltip.select("table").append("tr"),
d=a.viz.definition.y[i];h.append("td").append("div").attr("class","legend-box").style("background-color",d.color);h.append("th").text(d.label[a.viz.lang]);h.append("td").text(f.format(e.y[i],a.viz.data.measures[a.keys[i]],d.format[a.viz.lang],a.viz.lang))}a.tooltip.show().transition().duration(50).style("opacity",1);a.prev_rulerkey=e.x}a.moveTooltip()};a.moveTooltip=function(){var c=d3.event.pageX-$(a.viz.scopeStr+" .body").offset().left,b=d3.event.pageY-$(a.viz.scopeStr+" .body").offset().top,c=
c>a.detail.width-a.detail.margin.left-a.tooltip.width()?c-a.tooltip.width()-30:c+30,b=0>b-a.tooltip.height()-30?15:b-a.tooltip.height()-15;a.tooltip.style("left",c+"px").style("top",b+"px")};a.hideTooltip=function(){a.prev_rulerkey=null;a.keyruler.hide();a.tooltip.transition().duration(250).style("opacity",1E-5).each("end",function(){a.tooltip.hide()})};this.fallback=function(){viz.changeDimensions((viz.getUrlVar("width")||800)*viz.size,(viz.getUrlVar("height")||395)*viz.size,!1);$(a.viz.scopeStr+
" .legend").hide();this.dataLabels=$.map(viz.data.measures,function(a,b){var e={};e.key=b;e.value=a;return e});$(a.viz.scopeStr+" .body").append("<div align='center'>  <img id='fallback'></div>");size=1>viz.size?0.7>viz.size?0.9*viz.size:0.95*viz.size:1*viz.size;date=new Date;dateStr=""+date.getFullYear()+(date.getMonth()+1)+date.getDate();$(a.viz.scopeStr+" .fallback").attr("src","css/images/fallback/timeline_"+viz.getUrlVar("data")+"_"+viz.lang+".png?d="+dateStr).attr("width",(viz.getUrlVar("width")||
800)*size).attr("height",(viz.getUrlVar("height")||350)*size*(600/350))};this.showOptions=function(){};this.resetBrush=function(){var c=12;void 0!==a.viz.definition.options&&void 0!==a.viz.definition.options.focused&&(c=a.viz.definition.options.focused);c=Math.max(0,this.data.length-c);this.brush.extent([this.data[c].x,this.axes.master.scale.x.domain()[1]])};this.reset=function(){this.resetBrush();this.brush(a.viz.scope.select(".brush"));this.legend.reset()};this.locale=function(){var a={lang:"NL",
text:{}},b={NL:{},FR:{},EN:{},DE:{}};a.select=function(e){a.text=b[e]};b.FR.Months="jan f\u00e9v mars avr mai juin juil ao\u00fbt sept oct nov d\u00e9c".split(" ");b.FR.Days="dimanche lundi mardi mercredi jeudi vendredi samedi".split(" ");b.FR.Options="Param\u00e8tres";b.FR.NoSVG="Votre browser ne supporte pas des visualisations en SVG. Faites un update ou utilisez un browser avec SVG-support pour pouvoir voir cette visualisation.";b.FR.Export="Faites l'export des donn\u00e9es (format .CSV)";b.FR.ExportHelp=
"* Copiez-collez par example en Excel";b.FR.Metadata="Telecharger la fiche de metadonn\u00e9es";b.NL.Months="jan feb maart apr mei juni juli aug sep okt nov dec".split(" ");b.NL.Days="zondag maandag dinsdag woensdag donderdag vrijdag zaterdag".split(" ");b.NL.Options="Opties";b.NL.NoSVG="Uw browser ondersteunt deze visualisatie die gebruikt maakt van de SVG-technologie niet goed. U dient uw browser te updaten om deze visualisatie in optimale omstandigheden te kunnen gebruiken.";b.NL.Export="Exporteer gegevens (.CSV-formaat)";
b.NL.ExportHelp="* Kopieer bv. in Excel";b.NL.Metadata="Download metadata-fiche";b.EN.Months="jan feb maart apr mei juni juli aug sep okt nov dec".split(" ");b.EN.Days="zondag maandag dinsdag woensdag donderdag vrijdag zaterdag".split(" ");b.EN.Options="Opties";b.EN.NoSVG="Uw browser ondersteunt deze visualisatie die gebruikt maakt van de SVG-technologie niet goed. U dient uw browser te updaten om deze visualisatie in optimale omstandigheden te kunnen gebruiken.";b.EN.Export="Exporteer gegevens (.CSV-formaat)";
b.EN.ExportHelp="* Kopieer bv. in Excel";b.EN.Metadata="Download metadata-fiche";b.DE.Months="jan feb maart apr mei juni juli aug sep okt nov dec".split(" ");b.DE.Days="zondag maandag dinsdag woensdag donderdag vrijdag zaterdag".split(" ");b.DE.Options="Opties";b.DE.NoSVG="Uw browser ondersteunt deze visualisatie die gebruikt maakt van de SVG-technologie niet goed. U dient uw browser te updaten om deze visualisatie in optimale omstandigheden te kunnen gebruiken.";b.DE.Export="Exporteer gegevens (.CSV-formaat)";
b.DE.ExportHelp="* Kopieer bv. in Excel";b.DE.Metadata="Download metadata-fiche";return a}();this.legend=function(){function c(){a.viz.scope.select(".legend").style("display","block");for(i=0;i<a.keys.length;i++){var c=a.viz.scope.select(".legend .series").append("div").attr("class","legend-series").attr("id",a.keys[i]).on("click",b.toggle),d=c.append("div").attr("class","legend-box");"undefined"!==typeof a.viz.definition.y[i].color&&d.style("background-color",a.viz.definition.y[i].color);c.append("div").attr("class",
"legend-label").text(a.viz.definition.y[i].label[a.viz.lang]);c.on("mouseover",function(b){for(var c=d3.select(this)[0][0].id,e=d3.select(this)[0][0],d=b=0;!d3.select(e).classed("body");)b+=e.offsetLeft,d+=e.offsetTop,e=e.offsetParent;a.tooltip.text(a.viz.definition.y[a.keys.indexOf(c)].label[a.viz.lang]).show();c=a.tooltip.width();a.tooltip.style("left",b-c-25+"px").style("top",d-5+"px").transition().duration(150).style("opacity",1)}).on("mouseout",a.hideTooltip)}}var b={};b.active;b.initialize=
function(){b.active=a.keys.slice(0);c()};b.toggle=function(){var c=d3.select(this);-1!=b.active.indexOf(c.attr("id"))?1<b.active.length&&(c.transition().style("opacity","0.3"),b.active.splice(b.active.indexOf(c.attr("id")),1)):(c.transition().style("opacity","1"),b.active.push(c.attr("id")));a.redraw()};b.isActive=function(c,d){return-1<b.active.indexOf(a.keys[d])};b.reset=function(){b.active=a.keys.slice(0);a.viz.scope.selectAll(".legend .series div").transition().style("opacity","1");a.redraw()};
return b}();this.axes=function(){function c(){b.detail.scale.x=d3.time.scale().range([0,a.detail.width-a.detail.margin.left-a.detail.margin.right]).domain(d3.extent(a.data,function(a){return a.x}));b.detail.scale.y=d3.scale.linear().range([a.detail.height-a.detail.margin.top-a.detail.margin.bottom,0]);b.detail.axis.x=d3.svg.axis().scale(b.detail.scale.x).orient("bottom").tickPadding(8).ticks(a.viz.definition.options.x_axis_ticks);b.detail.axis.y=d3.svg.axis().scale(b.detail.scale.y).orient("left").tickPadding(8).tickFormat(d3.format(a.viz.definition.y[0].format[a.viz.lang])).ticks(15);
b.master.scale.x=d3.time.scale().range([0,a.master.width-a.master.margin.left-a.master.margin.right]).domain(d3.extent(a.data,function(a){return a.x}));b.master.scale.y=d3.scale.linear().range([a.master.height-a.master.margin.top-a.master.margin.bottom,0]).domain([d3.min(a.data,function(a){return Math.min.apply(null,a.y)}),d3.max(a.data,function(a){return Math.max.apply(null,a.y)})]).nice();b.master.axis.x=d3.svg.axis().scale(b.master.scale.x).orient("bottom").tickPadding(8)}var b={master:{scale:{x:null,
y:null},axis:{x:null,y:null}},detail:{scale:{x:null,y:null},axis:{x:null,y:null}},initialize:function(){c()}};return b}()}}();